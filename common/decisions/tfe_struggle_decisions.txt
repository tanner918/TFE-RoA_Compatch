

###################################################
# 
# BRITANNIA STRUGGLE ENDINGS
# By Abby
# 
###################################################


consolidate_the_heptarchy_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_germanic_warrior.dds"
	}
	decision_group_type = major

	desc = consolidate_the_heptarchy_decision_desc
	selection_tooltip = consolidate_the_heptarchy_decision_tooltip
	ai_check_interval = 60

	is_shown = {
		is_ruler = yes
		is_landed = yes
		exists = global_var:wre_collapsed #WRE has fallen
		exists = dynasty
		### Check for Germanic Culture
		OR = {
			culture = { has_cultural_pillar = heritage_west_germanic } # For Saxons
			culture = { has_cultural_pillar = heritage_central_germanic } # This way other germanic lords that end up in Britan may do it too
		}
		any_held_title = {
			tier = tier_county
			title_province = { geographical_region = custom_england }
		}
		NOT = {  #Can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:consolidated_heptarchy
			}
		}
		NOT = {
			government_has_flag = government_is_tribal
			has_government = republic_government
			has_government = clan_government
		}
		exists = struggle:britannia_struggle
	}

	is_valid = {
		#Must be independent.
		is_independent_ruler = yes
		#Has to be around to organise the assets.
		is_imprisoned = no
		#There must be atleast seven independent germanic realms.
		#Should have a decent prestige level.
		prestige_level >= high_prestige_level
		any_ruler = {
			count >= 7
			custom_description = {
				text = TFE_is_heptarch_trigger_desc
				TFE_is_heptarch_trigger = yes
			}
		}
	}

	is_valid_showing_failures_only = {
		is_available_at_peace_adult = yes
	}

	effect = {
		change_government = feudal_government
		add_prestige = massive_prestige_gain
		dynasty = {
			add_dynasty_modifier = {
				modifier = TFE_heptarch_modifier
			}
		}
		custom_tooltip = TFE_heptarchy_has_been_claimed_effects_desc
		trigger_event = tfe_british_isles.0001
	}

	ai_potential = {
		always = yes
	}

	cost = {
		gold = major_gold_value
	}

	ai_will_do = {
		base = 100
	}
}

establish_the_old_north = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	decision_group_type = major

	ai_check_interval = 30

	is_shown = {
		is_ruler = yes
		is_landed = yes
		AND = {
			exists = struggle:britannia_struggle	
			struggle:britannia_struggle = {
				AND = {
					is_culture_involved_in_struggle = root.culture
				}
			}
		}
		exists = dynasty
		OR = {
			culture = { has_cultural_pillar = heritage_brythonic }
			culture = { has_cultural_pillar = heritage_goidelic }
			culture = { has_cultural_pillar = heritage_celtic }
		}
		capital_county = {
			title_province = { geographical_region = old_north }
		}
		NOT = {  #Can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_old_north
			}
		}
		highest_held_title_tier <= tier_duchy
		title:k_old_north = {
			AND = {
				is_titular = yes
				is_title_created = no
			}	
		}
	}

	is_valid = {
		OR = { #Independent or vassal of an Emperor
			is_independent_ruler = yes
			top_liege.primary_title.tier >= tier_empire
		}
		prestige_level >= medium_prestige_level
		has_title = title:d_northumberland
		has_title = title:d_lancaster
		has_title = title:d_lothian
		has_title = title:d_galloway
		completely_controls_region = old_north
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		show_as_tooltip = { old_north_scripted_effect = yes }
		trigger_event = { id = britannia_struggle.7000 }
		every_player = {
			limit = {
				NOT = { this = scope:founder }
				top_liege = {
					OR = {
						this = scope:founder
						any_neighboring_and_across_water_top_liege_realm_owner = { this = scope:founder }
					}
				}
			}
			trigger_event = britannia_struggle.7001
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_old_north
			}
		}
	}
}


# Ending Decisions

# Hostility - Generic
struggle_britannia_ending_hostility_decision_generic = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/fp2_decision_struggle_hostility.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/fp2_decision_hostility.dds"
	decision_group_type = major

	title = struggle_britannia_ending_hostility_decision_generic
	desc = struggle_britannia_ending_hostility_decision_generic_desc
	selection_tooltip = struggle_britannia_ending_hostility_decision_tooltip
	is_invisible = yes

	is_valid = {
		is_independent_ruler = yes

		custom_description = {
			text = NO_OTHER_DECISION_AVAILABLE
			NOR = {
				culture = { has_cultural_pillar = heritage_west_germanic }
				# Norse have the ability to end the struggle using the Daneland decision, but they can also use the generic decision because the Danelaw has a chance to fail if it is refused
				culture = { has_cultural_pillar = heritage_brythonic }
				culture = { has_cultural_pillar = heritage_goidelic }
				culture = { has_cultural_pillar = heritage_celtic }
			}
		}

		custom_tooltip = {
			text = struggle_britannia_ending_hostility_decision_correct_phase_tt
			any_character_struggle = {
				involvement = involved  # Only only available for involved
				AND = {
					is_struggle_type = britannia_struggle
					is_struggle_phase = struggle_britannia_phase_hostility
				}
			}
		}

		# Hold and completely control at least two kingdoms
		custom_tooltip = { #
			text = struggle_britannia_ending_hostility_decision_kingdom_tt
			any_held_title = { # 1st kingdom
				tier = tier_kingdom
				de_jure_liege = title:e_britannia
				root = { completely_controls = prev }
				save_temporary_scope_as = kingdom_1
			}
			any_held_title = { # 2nd kingdom
				tier = tier_kingdom
				de_jure_liege = title:e_britannia
				trigger_if = {
					limit = { exists = scope:kingdom_1 }
					NOT = { this = scope:kingdom_1 }
				}
				root = { completely_controls = prev }
				save_temporary_scope_as = kingdom_2
			}
		}

		# 80% capital kingdom's de jure counties are of your culture and faith
		custom_tooltip = {
			text = struggle_britannia_ending_hostility_decision_county_tt
			capital_county.de_jure_liege.de_jure_liege = {
				any_de_jure_county = {
					percent >= 0.8
					culture = root.culture
					faith = root.faith
				}
			}
		}

		# No other realm controls more than 20% of the Britannia region
		custom_tooltip = {
			text = struggle_britannia_ending_hostility_decision_region_tt
			NOT = {
				struggle:britannia_struggle = {
					any_involved_ruler = {
						NOT = { this = root }
						is_independent_ruler = yes
						exists = primary_title
						primary_title = { is_mercenary_company = no }
						save_temporary_scope_as = britannian_realm
						any_county_in_region = {
							region = world_europe_west_britannia
							percent > fp2_struggle_hostility_region_percent_decimal_value
							holder.top_liege = scope:britannian_realm
						}
					}
				}
			}
		}

		# Completely control at least six of the ten most important British duchies
		calc_true_if = {
			amount >= 6
			completely_controls = title:d_cornwall
			completely_controls = title:d_bedford  # Essex
			completely_controls = title:d_gwynedd
			completely_controls = title:d_northumberland
			completely_controls = title:d_hereford
			completely_controls = title:d_somerset  # Wessex
			completely_controls = title:d_galloway  # Strathclyde
			completely_controls = title:d_albany
			completely_controls = title:d_meath
			completely_controls = title:d_munster
		}
	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = britannia_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_conqueror
		}
		# Britannia is available!
		custom_tooltip = britannia_struggle_can_create_empire_of_britannia_tt
		custom_description_no_bullet = { text = "britannia_struggle_house_tt" }
		# Keep the Struggle Clash for your House
		custom_tooltip = britannia_struggle_can_keep_using_struggle_clash_tt
		# Boost to culture and faith conversion
		custom_tooltip = britannia_struggle_hostility_conversion_tt
		# Damage opinion with other culture/faiths
		custom_tooltip = britannia_struggle_hostility_opinion_tt
		custom_tooltip = britannia_struggle_hostility_opinion_negative_tt
		# Choose Holy War boost, Culture War boost, or both
		custom_description_no_bullet = { text = "britannia_struggle_hostility_list_tt" }
		#custom_tooltip = britannia_struggle_hostility_holy_cb_joint_tt
		#custom_tooltip = britannia_struggle_hostility_culture_cb_tt

		show_as_tooltip = {
			stress_impact = {
				humble = medium_stress_impact_gain
				cynical = medium_stress_impact_gain
			}
		}

		# Trigger a player facing event as a coda
		trigger_event = britannia_struggle.9000
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

# Hostility - Germanic
struggle_britannia_ending_hostility_decision_germanic = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_destiny.dds"
	decision_group_type = major

	title = struggle_britannia_ending_hostility_decision_germanic
	desc = struggle_britannia_ending_hostility_decision_germanic_desc
	selection_tooltip = struggle_britannia_ending_hostility_decision_tooltip
	is_invisible = yes

	is_valid = {
		is_independent_ruler = yes

		# Must be West Germanic
		culture = { has_cultural_pillar = heritage_west_germanic }

		custom_tooltip = {
			text = struggle_britannia_ending_hostility_decision_correct_phase_tt
			any_character_struggle = {
				involvement = involved  # Only only available for involved
				AND = {
					is_struggle_type = britannia_struggle
					is_struggle_phase = struggle_britannia_phase_hostility
				}
			}
		}

		# Hold and completely control at least two kingdoms
		custom_tooltip = { #
			text = struggle_britannia_ending_hostility_decision_kingdom_tt
			any_held_title = { # 1st kingdom
				tier = tier_kingdom
				de_jure_liege = title:e_britannia
				root = { completely_controls = prev }
				save_temporary_scope_as = kingdom_1
			}
			any_held_title = { # 2nd kingdom
				tier = tier_kingdom
				de_jure_liege = title:e_britannia
				trigger_if = {
					limit = { exists = scope:kingdom_1 }
					NOT = { this = scope:kingdom_1 }
				}
				root = { completely_controls = prev }
				save_temporary_scope_as = kingdom_2
			}
		}

		# 80% capital kingdom's de jure counties are of your culture and faith
		custom_tooltip = {
			text = struggle_britannia_ending_hostility_decision_county_tt
			capital_county.de_jure_liege.de_jure_liege = {
				any_de_jure_county = {
					percent >= 0.8
					culture = root.culture
					faith = root.faith
				}
			}
		}

		# No other realm controls more than 20% of the Britannia region
		custom_tooltip = {
			text = struggle_britannia_ending_hostility_decision_region_tt
			NOT = {
				struggle:britannia_struggle = {
					any_involved_ruler = {
						NOT = { this = root }
						is_independent_ruler = yes
						exists = primary_title
						primary_title = { is_mercenary_company = no }
						save_temporary_scope_as = britannian_realm
						any_county_in_region = {
							region = world_europe_west_britannia
							percent > fp2_struggle_hostility_region_percent_decimal_value
							holder.top_liege = scope:britannian_realm
						}
					}
				}
			}
		}

		# Must hold the kingdom of England (not Britannia, must be created using a decision)
		has_title = title:k_england

		# Completely control all of the Heptarchy titles
		AND = {
			completely_controls = title:d_somerset  # Wessex
			completely_controls = title:d_bedford  # Essex
			completely_controls = title:c_sussex  # Sussex
			completely_controls = title:d_canterbury  # Kent
			completely_controls = title:d_norfolk  # East Anglia
			completely_controls = title:d_hereford  # Mercia
			completely_controls = title:d_northumberland  # Northumbria
		}

		# Completely control at least three of the six important duchies outside of England
		calc_true_if = {
			amount >= 3
			completely_controls = title:d_cornwall
			completely_controls = title:d_gwynedd
			completely_controls = title:d_galloway  # Strathclyde
			completely_controls = title:d_albany
			completely_controls = title:d_meath
			completely_controls = title:d_munster
		}
	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = britannia_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_conqueror
		}
		# Britannia is available!
		custom_tooltip = britannia_struggle_get_empire_of_britannia_tt
		custom_tooltip = britannia_color_change_tt
		custom_description_no_bullet = { text = "britannia_struggle_house_tt" }
		# Keep the Struggle Clash for your House
		custom_tooltip = britannia_struggle_can_keep_using_struggle_clash_tt
		# Boost to culture and faith conversion
		custom_tooltip = britannia_struggle_hostility_conversion_tt
		# Damage opinion with other culture/faiths
		custom_tooltip = britannia_struggle_hostility_opinion_tt
		custom_tooltip = britannia_struggle_hostility_opinion_negative_tt
		# Choose Holy War boost, Culture War boost, or both
		custom_description_no_bullet = { text = "britannia_struggle_hostility_list_tt" }

		show_as_tooltip = {
			stress_impact = {
				humble = medium_stress_impact_gain
				cynical = medium_stress_impact_gain
			}
		}

		# Trigger a player facing event as a coda
		trigger_event = britannia_struggle.9001
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

# Hostility - Celtic
struggle_britannia_ending_hostility_decision_celtic = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_destiny.dds"
	decision_group_type = major

	title = struggle_britannia_ending_hostility_decision_celtic
	desc = struggle_britannia_ending_hostility_decision_celtic_desc
	selection_tooltip = struggle_britannia_ending_hostility_decision_tooltip
	is_invisible = yes

	is_valid = {
		is_independent_ruler = yes

		# Must be Celtic
		custom_description = {
			text = britannia_struggle_is_celtic_desc
			OR = {
				culture = { has_cultural_pillar = heritage_brythonic }
				culture = { has_cultural_pillar = heritage_goidelic }
				culture = { has_cultural_pillar = heritage_celtic }
			}
		}

		custom_tooltip = {
			text = struggle_britannia_ending_hostility_decision_correct_phase_tt
			any_character_struggle = {
				involvement = involved  # Only only available for involved
				is_struggle_type = britannia_struggle
				is_struggle_phase = struggle_britannia_phase_hostility
			}
		}

		# Hold and completely control at least two kingdoms
		custom_tooltip = { #
			text = struggle_britannia_ending_hostility_decision_kingdom_tt
			any_held_title = { # 1st kingdom
				tier = tier_kingdom
				de_jure_liege = title:e_britannia
				root = { completely_controls = prev }
				save_temporary_scope_as = kingdom_1
			}
			any_held_title = { # 2nd kingdom
				tier = tier_kingdom
				de_jure_liege = title:e_britannia
				trigger_if = {
					limit = { exists = scope:kingdom_1 }
					NOT = { this = scope:kingdom_1 }
				}
				root = { completely_controls = prev }
				save_temporary_scope_as = kingdom_2
			}
		}

		# 80% capital kingdom's de jure counties are of your culture and faith
		custom_tooltip = {
			text = struggle_britannia_ending_hostility_decision_county_tt
			capital_county.de_jure_liege.de_jure_liege = {
				any_de_jure_county = {
					percent >= 0.8
					culture = root.culture
					faith = root.faith
				}
			}
		}

		# No other realm controls more than 20% of the Britannia region
		custom_tooltip = {
			text = struggle_britannia_ending_hostility_decision_region_tt
			NOT = {
				struggle:britannia_struggle = {
					any_involved_ruler = {
						NOT = { this = root }
						is_independent_ruler = yes
						exists = primary_title
						primary_title = { is_mercenary_company = no }
						save_temporary_scope_as = britannian_realm
						any_county_in_region = {
							region = world_europe_west_britannia
							percent > fp2_struggle_hostility_region_percent_decimal_value
							holder.top_liege = scope:britannian_realm
						}
					}
				}
			}
		}

		# Completely control four of the six important duchies outside England
		calc_true_if = {
			amount >= 4
			completely_controls = title:d_cornwall
			completely_controls = title:d_gwynedd
			completely_controls = title:d_galloway  # Strathclyde
			completely_controls = title:d_albany
			completely_controls = title:d_meath
			completely_controls = title:d_munster
		}

		# Additionally control three of the seven Heptarchy titles
		calc_true_if = {
			amount >= 3
			completely_controls = title:d_somerset  # Wessex
			completely_controls = title:d_bedford  # Essex
			completely_controls = title:c_sussex  # Sussex
			completely_controls = title:d_canterbury  # Kent
			completely_controls = title:d_norfolk  # East Anglia
			completely_controls = title:d_hereford  # Mercia
			completely_controls = title:d_northumberland  # Northumbria
		}
	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = britannia_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_conqueror
		}
		# Britannia is available!
		custom_tooltip = britannia_struggle_get_empire_of_britannia_tt
		custom_tooltip = britannia_color_change_tt
		custom_description_no_bullet = { text = "britannia_struggle_house_tt" }
		# Keep the Struggle Clash for your House
		custom_tooltip = britannia_struggle_can_keep_using_struggle_clash_tt
		# Boost to culture and faith conversion
		custom_tooltip = britannia_struggle_hostility_conversion_tt
		# Damage opinion with other culture/faiths
		custom_tooltip = britannia_struggle_hostility_opinion_tt
		custom_tooltip = britannia_struggle_hostility_opinion_negative_tt
		# Choose Holy War boost, Culture War boost, or both
		custom_description_no_bullet = { text = "britannia_struggle_hostility_list_tt" }

		show_as_tooltip = {
			stress_impact = {
				humble = medium_stress_impact_gain
				cynical = medium_stress_impact_gain
			}
		}

		# Trigger a player facing event as a coda
		trigger_event = britannia_struggle.9002
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

# Hostility - Roman Emperor
struggle_britannia_ending_hostility_decision_roman = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_roman_knight.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_roman_knight.dds"
	decision_group_type = major
	
	title = struggle_britannia_ending_hostility_decision_roman
	desc = struggle_britannia_ending_hostility_decision_roman_desc
	selection_tooltip = struggle_britannia_ending_hostility_decision_tooltip

	is_shown = {
		exists = struggle:britannia_struggle

		OR = {
			any_vassal = {
				has_title = title:k_gallia
			}
			any_vassal = {
				has_title = title:k_germania
			}
			has_title = title:k_gallia
			has_title = title:k_germania
		}
		OR = {
			has_title = title:e_roman_empire
			has_title = title:e_western_roman_empire
			has_title = title:e_gaul
			has_title = title:e_byzantium
		}

	}

	is_valid = {
		is_independent_ruler = yes

		# You are a Roman emperor
		OR = {
			has_title = title:e_roman_empire
			has_title = title:e_western_roman_empire
			has_title = title:e_gaul
			has_title = title:e_byzantium
		}

		# No other realm controls more than 20% of the Britannia region
		custom_tooltip = {
			text = struggle_britannia_ending_hostility_decision_region_tt
			NOT = {
				struggle:britannia_struggle = {
					any_involved_ruler = {
						NOT = { this = root }
						is_independent_ruler = yes
						exists = primary_title
						primary_title = { is_mercenary_company = no }
						save_temporary_scope_as = britannian_realm
						any_county_in_region = {
							region = world_europe_west_britannia
							percent > fp2_struggle_hostility_region_percent_decimal_value
							holder.top_liege = scope:britannian_realm
						}
					}
				}
			}
		}

		custom_tooltip = {
			text = RECLAIMED_BRITANNIA
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:britannia_reclaimed
			}
		}
		custom_tooltip = {
			text = CREATED_CALEDONIA
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:created_province_of_caledonia
			}
		}
		custom_tooltip = {
			text = CREATED_HIBERNIA
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:created_province_of_hibernia
			}
		}
	}

	effect = {
		hidden_effect = {
			title:e_britannia = {
				every_in_de_jure_hierarchy = {
					limit = {
						tier = tier_kingdom
					}
					set_de_jure_liege_title = root.primary_title
				}
			}
		}
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = britannia_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_britannicus
		}
		# Britannia is available!
		custom_tooltip = britannia_struggle_can_create_empire_of_britannia_tt
		custom_description_no_bullet = { text = "britannia_struggle_house_tt" }
		# Keep the Struggle Clash for your House
		custom_tooltip = britannia_struggle_can_keep_using_struggle_clash_tt
		# Boost to culture and faith conversion
		custom_tooltip = britannia_struggle_hostility_conversion_tt
		# Damage opinion with other culture/faiths
		custom_tooltip = britannia_struggle_hostility_opinion_tt
		custom_tooltip = britannia_struggle_hostility_opinion_negative_tt
		# Choose Holy War boost, Culture War boost, or both
		custom_description_no_bullet = { text = "britannia_struggle_hostility_list_tt" }
		#custom_tooltip = britannia_struggle_hostility_holy_cb_joint_tt
		#custom_tooltip = britannia_struggle_hostility_culture_cb_tt

		show_as_tooltip = {
			stress_impact = {
				humble = medium_stress_impact_gain
				cynical = medium_stress_impact_gain
			}
		}

		# Trigger a player facing event as a coda
		trigger_event = britannia_struggle.9003
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

# Conciliation
struggle_britannia_ending_conciliation_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/fp2_decision_struggle_conciliation.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/fp2_decision_conciliation.dds"
	decision_group_type = major

	title = struggle_britannia_ending_conciliation_decision
	desc = struggle_britannia_ending_conciliation_decision_desc
	selection_tooltip = struggle_britannia_ending_conciliation_decision_tooltip
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_britannia_ending_conciliation_decision_correct_phase_tt
			any_character_struggle = {
				involvement = involved
				AND = {
					is_struggle_type = britannia_struggle
					is_struggle_phase = struggle_britannia_phase_conciliation
				}
			}
		}

		prestige_level >= very_high_prestige_level # Exalted among Men or higher

		# Hold and completely control a de jure kingdom of Hispania
		custom_tooltip = {
			text = struggle_britannia_ending_compromise_decision_kingdom_tt
			tfe_struggle_ending_hold_de_jure_kingdom_trigger = yes
		}

		# All involved rulers in Britannia are allied to you
		custom_tooltip = {
			text = struggle_britannia_ending_conciliation_decision_alliance_tt
			struggle:britannia_struggle = {
				NOT = {
					any_involved_ruler = {
						is_independent_ruler = yes
						primary_title = { is_mercenary_company = no }
						primary_title = { is_holy_order = no }
						NOR = {
							this = root
							is_allied_to = root
						}
					}
				}
			}
		}

		# Control less than 60% of Britannia
		custom_tooltip = {
			text = struggle_britannia_ending_compromise_decision_region_tt
			tfe_struggle_ending_percent_britannia_trigger = yes
		}
	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = britannia_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			britannia_struggle_conciliation_ender_effect = yes
			britannia_struggle_conciliation_tooltip_effect = yes
			britannia_struggle_conciliation_modifier_rewards_effect = yes
		}

		show_as_tooltip = {
			stress_impact = {
				arrogant = medium_stress_impact_gain
				zealous = medium_stress_impact_gain
			}
		}

		# Trigger a player facing event as a coda
		trigger_event = britannia_struggle.9100
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

# Germanic kingdoms
found_wessex_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	decision_group_type = major

	ai_check_interval = 60

	is_shown = {
		is_ruler = yes
		is_landed = yes
		AND = {
			exists = struggle:britannia_struggle	
			struggle:britannia_struggle = {
				AND = {
					is_culture_involved_in_struggle = root.culture
				}
			}
		}
		exists = dynasty
		culture = {
			has_cultural_pillar = heritage_west_germanic
		}
		NOT = {  #Can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_wessex
			}
		}
		highest_held_title_tier <= tier_duchy
		title:k_wessex = {
			AND = {
				is_titular = yes
				is_title_created = no
			}	
		}
		capital_county.title_province = {
			geographical_region = struggle_wessex
		}
	}

	is_valid = {
		OR = { #Independent or vassal of an Emperor
			is_independent_ruler = yes
			top_liege.primary_title.tier >= tier_empire
		}
		prestige_level >= medium_prestige_level
		completely_controls = title:d_somerset
		custom_description = {
			text = AT_LEAST_THREE_DUCHY_TITLES
			any_held_title = {
				count >= 3
				tier = tier_duchy
			}
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		get_title = title:k_wessex
		every_held_title = {
			limit = {
				tier = tier_duchy
			}
			set_de_jure_liege_title = title:k_wessex
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_wessex
			}
		}
	}

	cost = { gold = { value = 150 } }

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

found_east_anglia_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	decision_group_type = major

	ai_check_interval = 60

	is_shown = {
		is_ruler = yes
		is_landed = yes
		AND = {
			exists = struggle:britannia_struggle	
			struggle:britannia_struggle = {
				AND = {
					is_culture_involved_in_struggle = root.culture
				}
			}
		}
		exists = dynasty
		culture = {
			has_cultural_pillar = heritage_west_germanic
		}
		NOT = {  #Can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_east_anglia
			}
		}
		highest_held_title_tier <= tier_duchy
		title:k_east_anglia = {
			AND = {
				is_titular = yes
				is_title_created = no
			}	
		}
		capital_county.title_province = {
			geographical_region = struggle_east_anglia
		}
	}

	is_valid = {
		OR = { #Independent or vassal of an Emperor
			is_independent_ruler = yes
			top_liege.primary_title.tier >= tier_empire
		}
		prestige_level >= medium_prestige_level
		completely_controls = title:d_norfolk
		custom_description = {
			text = AT_LEAST_THREE_DUCHY_TITLES
			any_held_title = {
				count >= 3
				tier = tier_duchy
			}
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		get_title = title:k_east_anglia
		every_held_title = {
			limit = {
				tier = tier_duchy
			}
			set_de_jure_liege_title = title:k_east_anglia
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_east_anglia
			}
		}
	}

	cost = { gold = { value = 150 } }

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

found_kent_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	decision_group_type = major

	ai_check_interval = 60

	is_shown = {
		is_ruler = yes
		is_landed = yes
		AND = {
			exists = struggle:britannia_struggle	
			struggle:britannia_struggle = {
				AND = {
					is_culture_involved_in_struggle = root.culture
				}
			}
		}
		exists = dynasty
		culture = {
			has_cultural_pillar = heritage_west_germanic
		}
		NOT = {  #Can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_kent
			}
		}
		highest_held_title_tier <= tier_duchy
		title:k_kent = {
			AND = {
				is_titular = yes
				is_title_created = no
			}	
		}
		capital_county.title_province = {
			geographical_region = struggle_kent
		}
	}

	is_valid = {
		OR = { #Independent or vassal of an Emperor
			is_independent_ruler = yes
			top_liege.primary_title.tier >= tier_empire
		}
		prestige_level >= medium_prestige_level
		completely_controls = title:d_canterbury
		custom_description = {
			text = AT_LEAST_THREE_DUCHY_TITLES
			any_held_title = {
				count >= 3
				tier = tier_duchy
			}
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		get_title = title:k_kent
		every_held_title = {
			limit = {
				tier = tier_duchy
			}
			set_de_jure_liege_title = title:k_kent
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_kent
			}
		}
	}

	cost = { gold = { value = 150 } }

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

found_northumbria_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	decision_group_type = major

	ai_check_interval = 60

	is_shown = {
		is_ruler = yes
		is_landed = yes
		AND = {
			exists = struggle:britannia_struggle	
			struggle:britannia_struggle = {
				AND = {
					is_culture_involved_in_struggle = root.culture
				}
			}
		}
		exists = dynasty
		culture = {
			has_cultural_pillar = heritage_west_germanic
		}
		NOT = {  #Can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_northumbria
			}
		}
		highest_held_title_tier <= tier_duchy
		title:k_northumbria = {
			AND = {
				is_titular = yes
				is_title_created = no
			}	
		}
		capital_county.title_province = {
			geographical_region = struggle_northumbria
		}
	}

	is_valid = {
		OR = { #Independent or vassal of an Emperor
			is_independent_ruler = yes
			top_liege.primary_title.tier >= tier_empire
		}
		prestige_level >= medium_prestige_level
		completely_controls = title:d_northumberland
		custom_description = {
			text = AT_LEAST_THREE_DUCHY_TITLES
			any_held_title = {
				count >= 3
				tier = tier_duchy
			}
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		get_title = title:k_northumbria
		every_held_title = {
			limit = {
				tier = tier_duchy
			}
			set_de_jure_liege_title = title:k_northumbria
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_northumbria
			}
		}
	}

	cost = { gold = { value = 150 } }
	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

found_mercia_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	decision_group_type = major

	ai_check_interval = 60

	is_shown = {
		is_ruler = yes
		is_landed = yes
		AND = {
			exists = struggle:britannia_struggle	
			struggle:britannia_struggle = {
				AND = {
					is_culture_involved_in_struggle = root.culture
				}
			}
		}
		exists = dynasty
		culture = {
			has_cultural_pillar = heritage_west_germanic
		}
		NOT = {  #Can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_mercia
			}
		}
		highest_held_title_tier <= tier_duchy
		title:k_mercia = {
			AND = {
				is_titular = yes
				is_title_created = no
			}	
		}
		capital_county.title_province = {
			geographical_region = struggle_mercia
		}
	}

	is_valid = {
		OR = { #Independent or vassal of an Emperor
			is_independent_ruler = yes
			top_liege.primary_title.tier >= tier_empire
		}
		prestige_level >= medium_prestige_level
		completely_controls = title:d_hereford
		custom_description = {
			text = AT_LEAST_THREE_DUCHY_TITLES
			any_held_title = {
				count >= 3
				tier = tier_duchy
			}
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		get_title = title:k_mercia
		every_held_title = {
			limit = {
				tier = tier_duchy
			}
			set_de_jure_liege_title = title:k_mercia
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_mercia
			}
		}
	}

	cost = { gold = { value = 150 } }

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

found_essex_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	decision_group_type = major

	ai_check_interval = 60

	is_shown = {
		is_ruler = yes
		is_landed = yes
		AND = {
			exists = struggle:britannia_struggle	
			struggle:britannia_struggle = {
				AND = {
					is_culture_involved_in_struggle = root.culture
				}
			}
		}
		exists = dynasty
		culture = {
			has_cultural_pillar = heritage_west_germanic
		}
		NOT = {  #Can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_essex
			}
		}
		highest_held_title_tier <= tier_duchy
		title:k_essex = {
			AND = {
				is_titular = yes
				is_title_created = no
			}	
		}
		capital_county.title_province = {
			geographical_region = struggle_essex
		}
	}

	is_valid = {
		OR = { #Independent or vassal of an Emperor
			is_independent_ruler = yes
			top_liege.primary_title.tier >= tier_empire
		}
		prestige_level >= medium_prestige_level
		completely_controls = title:d_bedford
		custom_description = {
			text = AT_LEAST_THREE_DUCHY_TITLES
			any_held_title = {
				count >= 3
				tier = tier_duchy
			}
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		get_title = title:k_essex
		every_held_title = {
			limit = {
				tier = tier_duchy
			}
			set_de_jure_liege_title = title:k_essex
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_essex
			}
		}
	}

	cost = { gold = { value = 150 } }

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

found_england_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	decision_group_type = major

	ai_check_interval = 60

	is_shown = {
		is_ruler = yes
		is_landed = yes
		AND = {
			exists = struggle:britannia_struggle	
			struggle:britannia_struggle = {
				AND = {
					is_culture_involved_in_struggle = root.culture
				}
			}
		}
		exists = dynasty
		culture = {
			has_cultural_pillar = heritage_west_germanic
		}
		NOT = {  #Can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_england
			}
		}
		highest_held_title_tier = tier_kingdom
		title:k_england = {
			AND = {
				is_titular = yes
				is_title_created = no
			}	
		}
		capital_county.title_province = {
			geographical_region = custom_england
		}
		OR = {
			has_title = title:k_wessex
			has_title = title:k_east_anglia
			has_title = title:k_kent
			has_title = title:k_northumbria
			has_title = title:k_mercia
			has_title = title:k_essex
		}
	}

	is_valid = {
		is_independent_ruler = yes
		prestige_level >= medium_prestige_level
		calc_true_if = {
			amount >= 6
			completely_controls = title:d_somerset  # Wessex
			completely_controls = title:d_bedford  # Essex
			completely_controls = title:c_sussex  # Sussex
			completely_controls = title:d_canterbury  # Kent
			completely_controls = title:d_norfolk  # East Anglia
			completely_controls = title:d_hereford  # Mercia
			completely_controls = title:d_northumberland  # Northumbria
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		get_title = title:k_england
		if = {
			limit = {
				has_title = title:k_wessex
			}
			destroy_title = title:k_wessex
		}
		if = {
			limit = {
				has_title = title:k_east_anglia
			}
			destroy_title = title:k_east_anglia
		}
		if = {
			limit = {
				has_title = title:k_kent
			}
			destroy_title = title:k_kent
		}
		if = {
			limit = {
				has_title = title:k_northumbria
			}
			destroy_title = title:k_northumbria
		}
		if = {
			limit = {
				has_title = title:k_mercia
			}
			destroy_title = title:k_mercia
		}
		if = {
			limit = {
				has_title = title:k_essex
			}
			destroy_title = title:k_essex
		}
		
		
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:established_england
			}
			every_held_title = {
				limit = {
					tier = tier_duchy
				}
				set_de_jure_liege_title = title:k_england
			}
			every_county_in_region = {
				region = britannia_england_decision
				limit = {
					NOT = {
						kingdom = title:k_england
					}
				}
				duchy = {
					set_de_jure_liege_title = title:k_england
				}
			}
		}
	}

	cost = { gold = { value = 150 } }

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}


#Comprimise uwu
struggle_britannia_ending_compromise_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_allegiance.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_allegiance.dds"
	decision_group_type = major

	title = struggle_britannia_ending_compromise_decision
	desc = struggle_britannia_ending_compromise_decision_desc
	selection_tooltip = struggle_britannia_ending_compromise_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_britannia_ending_compromise_decision_correct_phase_tt
			any_character_struggle = {
				AND = {
					is_struggle_type = britannia_struggle
					is_struggle_phase = struggle_britannia_phase_compromise
				}
			}
		}

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = britannia_struggle
			}
		}

		OR = {
			# Exalted among Men or higher
			prestige_level >= very_high_prestige_level
			# Hold and completely control a de jure kingdom of Hispania
			custom_tooltip = {
				text = struggle_britannia_ending_compromise_decision_kingdom_tt
				tfe_struggle_ending_hold_de_jure_kingdom_trigger = yes
			}
		}

		# Control less than 50% of Iberia
		custom_tooltip = {
			text = struggle_britannia_ending_compromise_decision_region_tt
			tfe_struggle_ending_percent_britannia_trigger = yes
		}

		# No one else controls more than 50% of Iberia
		custom_tooltip = {
			text = struggle_britannia_ending_compromise_decision_other_region_tt
			tfe_struggle_ending_other_percent_britannia_trigger = yes
		}

		# No Independent Involved rulers are at war with each other
		custom_tooltip = {
			text = struggle_iberia_ending_compromise_truce_tt
			NOT = {
				struggle:britannia_struggle = {
					any_involved_ruler = {
						is_independent_ruler = yes
						primary_title = { is_mercenary_company = no }
						any_primary_war_enemy = {
							is_independent_ruler = yes
							any_character_struggle = {
								involvement = involved
								is_struggle_type = britannia_struggle
							}
							primary_title = { is_mercenary_company = no }
						}
					}
				}
			}
		}

		OR = {
			# Every other involved independent ruler in Iberia has at least 60 opinion of you or is strong hooked
			custom_tooltip = {
				text = struggle_britannia_ending_compromise_decision_opinion_tt
				struggle:britannia_struggle = {
					NOT = {
						any_involved_ruler = {
							NOT = { this = root }
							is_independent_ruler = yes
							primary_title = { is_holy_order = no }
							primary_title = { is_mercenary_company = no }
							save_temporary_scope_as = this_character
							NOR = {
								root = { has_strong_hook = scope:this_character }
								opinion = {
									target = root
									value >= struggle_iberia_ending_compromise_decision_opinion_value
								}
							}
						}
					}
				}
			}
			# No other independent ruler in Iberia is a king or above
			custom_tooltip = {
				text = struggle_britannia_ending_compromise_decision_independent_tt
				struggle:britannia_struggle = {
					NOT = {
						any_involved_ruler = {
							NOT = { this = root }
							is_independent_ruler = yes
							primary_title = { is_mercenary_company = no }
							primary_title.tier >= tier_kingdom
						}
					}
				}
			}
			# More than 25% of Iberia is controlled by Interloper or Uninvolved rulers
			custom_tooltip = {
				text = struggle_britannia_ending_compromise_decision_interloper_tt
				any_county_in_region = {
					region = world_europe_west_britannia
					percent > fp2_struggle_compromise_uninvolved_percent_decimal_value
					holder.top_liege = { tfe_character_interloper_in_struggle_trigger = yes }
				}
			}
		}

		# Completely control any of the important Iberian duchies
		calc_true_if = {
			amount >= 1
			completely_controls = title:d_cornwall
			completely_controls = title:d_gwynedd
			completely_controls = title:d_galloway
			completely_controls = title:d_albany
			completely_controls = title:d_meath
			completely_controls = title:d_munster
		}
	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = britannia_struggle
			}
		}
		##### Major Effects #####
		# Personal effects for ruler
		show_as_tooltip = { tfe_struggle_compromise_ender_effect = yes }
		# Independent/Split De Jure Duchies will become De Jure Kingdoms
		if = {
			limit = {
				title:e_britannia = {
					any_in_de_jure_hierarchy = { fp2_struggle_ending_compromise_independent_duchy_trigger = yes }
				}
			}
			custom_tooltip = tfe_struggle_compromise_create_new_kingdoms_tt
		}
		# Other Tooltips!
		tfe_struggle_compromise_tooltip_effect = yes

		##### Minor Effects #####
		# Self-sufficiency/defensive modifiers for each independent realm
		show_as_tooltip = { fp2_struggle_compromise_modifier_rewards_effect = yes }

		show_as_tooltip = {
			stress_impact = {
				arrogant = medium_stress_impact_gain
			}
		}


		# Trigger a player facing event as a coda
		trigger_event = britannia_struggle.0901
	}

	cost = { gold = { value = 150 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}



###################################################
# 
# ROMAN-PERSIAN STRUGGLE ENDINGS
# By cybrxkhan
# 
###################################################



# Roman Total Victory
struggle_roman_persian_ending_roman_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_ere.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_ere.dds"
	decision_group_type = major

	title = struggle_roman_persian_ending_roman_decision
	desc = struggle_roman_persian_ending_roman_decision_desc
	selection_tooltip = struggle_roman_persian_ending_roman_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		# custom_tooltip = {
		# 	text = struggle_roman_persian_ending_roman_decision_correct_phase_tt
		# 	any_character_struggle = {
		# 		is_struggle_type = roman_persian_struggle
		# 		is_struggle_phase = struggle_britannia_phase_compromise
		# 	}
		# }

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = roman_persian_struggle
			}
		}

		prestige_level >= 3

		OR = {
			has_title = title:e_roman_empire
			has_title = title:e_western_roman_empire
			has_title = title:e_byzantium
		}

		NOT = { has_title = title:e_persia }

		OR = {
			culture = { has_cultural_pillar = heritage_latin } # Romans
			culture = { has_cultural_pillar = heritage_hellenistic } # Greeks
		}

		# No other realm controls more than 20% of the region
		custom_tooltip = {
			text = struggle_roman_persian_ending_total_victory_decision_region_tt
			NOT = {
				struggle:roman_persian_struggle = {
					any_involved_ruler = {
						NOT = { this = root }
						is_independent_ruler = yes
						exists = primary_title
						primary_title = { is_mercenary_company = no }
						save_temporary_scope_as = roman_persian_region_realm
						any_county_in_region = {
							region = TFE_roman_persian_struggle_region
							percent > fp2_struggle_hostility_region_percent_decimal_value
							holder.top_liege = scope:roman_persian_region_realm
						}
					}
				}
			}
		}

		# Completely control the 2 capital duchies
		completely_controls = title:d_thrace # Constantinople
		completely_controls = title:d_baghdad # Ctesiphon

		# Completely control at least 2 of the other important duchies
		calc_true_if = {
			amount >= 2
			completely_controls = title:d_palestina_prima # Jerusalem
			completely_controls = title:d_antioch # Antioch
			completely_controls = title:d_khuzestan # Khuzestan
		}
	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = roman_persian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_great
			if = {
				limit = {
					exists = title:e_persia
				}
				destroy_title = title:e_persia
			}
			if = {
				limit = {
					exists = title:e_roman_empire
				}
				custom_tooltip = struggle_roman_persian_total_victory_rome_de_jure_tt
			}
			else_if = {
				limit = {
					exists = title:e_byzantium
				}				
				custom_tooltip = struggle_roman_persian_total_victory_ere_de_jure_tt
			}
			else_if = {
				limit = {
					exists = title:e_western_roman_empire
				}				
				custom_tooltip = struggle_roman_persian_total_victory_wre_de_jure_tt
			}
		}
		# Boost to culture and faith conversion
		custom_tooltip = struggle_roman_persian_ending_total_victory_conversion_tt
		# Choose war boost, religion boost, or political boost
		custom_description_no_bullet = { text = struggle_roman_persian_modifier_list_tt }

		# Trigger a player facing event as a coda
		trigger_event = roman_persian_struggle.1000
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}


# Persian Total Victory
struggle_roman_persian_ending_persian_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_eran.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_eran.dds"
	decision_group_type = major

	title = struggle_roman_persian_ending_persian_decision
	desc = struggle_roman_persian_ending_persian_decision_desc
	selection_tooltip = struggle_roman_persian_ending_persian_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		# custom_tooltip = {
		# 	text = struggle_roman_persian_ending_persian_decision_correct_phase_tt
		# 	any_character_struggle = {
		# 		is_struggle_type = roman_persian_struggle
		# 		is_struggle_phase = struggle_britannia_phase_compromise
		# 	}
		# }

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = roman_persian_struggle
			}
		}

		prestige_level >= 3

		has_title = title:e_persia

		NOR = {
			has_title = title:e_roman_empire
			has_title = title:e_western_roman_empire
			has_title = title:e_byzantium
		}

		OR = {
			culture = { has_cultural_pillar = heritage_iranian } # West Iranians
			culture = { has_cultural_pillar = heritage_tocharian } # East Iranian
		}

		# No other realm controls more than 20% of the region
		custom_tooltip = {
			text = struggle_roman_persian_ending_total_victory_decision_region_tt
			NOT = {
				struggle:roman_persian_struggle = {
					any_involved_ruler = {
						NOT = { this = root }
						is_independent_ruler = yes
						exists = primary_title
						primary_title = { is_mercenary_company = no }
						save_temporary_scope_as = roman_persian_region_realm
						any_county_in_region = {
							region = TFE_roman_persian_struggle_region
							percent > fp2_struggle_hostility_region_percent_decimal_value
							holder.top_liege = scope:roman_persian_region_realm
						}
					}
				}
			}
		}

		# Completely control the 2 capital duchies
		completely_controls = title:d_thrace # Constantinople
		completely_controls = title:d_baghdad # Ctesiphon

		# Completely control at least 2 of the other important duchies
		calc_true_if = {
			amount >= 2
			completely_controls = title:d_palestina_prima # Jerusalem
			completely_controls = title:d_antioch # Antioch
			completely_controls = title:d_khuzestan # Khuzestan
		}
	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = roman_persian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_great
			if = {
				limit = {
					exists = title:e_roman_empire
				}
				destroy_title = title:e_roman_empire
			}
			if = {
				limit = {
					exists = title:e_byzantium
				}
				destroy_title = title:e_byzantium
			}
			custom_tooltip = struggle_roman_persian_total_victory_persian_de_jure_tt
		}
		# Boost to culture and faith conversion
		custom_tooltip = struggle_roman_persian_ending_total_victory_conversion_tt
		# Choose war boost, religion boost, or political boost
		custom_description_no_bullet = { text = struggle_roman_persian_modifier_list_tt }

		# Trigger a player facing event as a coda
		trigger_event = roman_persian_struggle.1002
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}




# Regional Power Total Victory
struggle_roman_persian_ending_regional_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/fp2_decision_struggle_compromise.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/fp2_decision_compromise.dds"
	decision_group_type = major

	title = struggle_roman_persian_ending_regional_decision
	desc = struggle_roman_persian_ending_regional_decision_desc
	selection_tooltip = struggle_roman_persian_ending_regional_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		# custom_tooltip = {
		# 	text = struggle_roman_persian_ending_regional_decision_correct_phase_tt
		# 	any_character_struggle = {
		# 		is_struggle_type = roman_persian_struggle
		# 		is_struggle_phase = struggle_britannia_phase_compromise
		# 	}
		# }

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = roman_persian_struggle
			}
		}

		prestige_level >= 4
		highest_held_title_tier = tier_empire

		# Control at least 75% of the struggle region
		custom_tooltip = {
			text = struggle_roman_persian_ending_regional_decision_region_tt
			struggle_roman_persian_ending_regional_decision_percent_region_trigger = yes
		}	


		NOR = {
			has_title = title:e_persia
			has_title = title:e_roman_empire
			has_title = title:e_western_roman_empire
			has_title = title:e_byzantium
		}
		custom_tooltip = {
			text = struggle_roman_persian_ending_regional_decision_heritage_tt
			NOR = {
				culture = { has_cultural_pillar = heritage_latin } # Romans
				culture = { has_cultural_pillar = heritage_hellenistic } # Greeks
				culture = { has_cultural_pillar = heritage_iranian } # West Iranians
				culture = { has_cultural_pillar = heritage_tocharian } # East Iranian
			}
		}

		# No other realm controls more than 20% of the region
		custom_tooltip = {
			text = struggle_roman_persian_ending_total_victory_decision_region_tt
			NOT = {
				struggle:roman_persian_struggle = {
					any_involved_ruler = {
						NOT = { this = root }
						is_independent_ruler = yes
						exists = primary_title
						primary_title = { is_mercenary_company = no }
						save_temporary_scope_as = roman_persian_region_realm
						any_county_in_region = {
							region = TFE_roman_persian_struggle_region
							percent > fp2_struggle_hostility_region_percent_decimal_value
							holder.top_liege = scope:roman_persian_region_realm
						}
					}
				}
			}
		}

		# Completely control at least 3 of the important duchies
		calc_true_if = {
			amount >= 3
			completely_controls = title:d_thrace # Constantinople
			completely_controls = title:d_baghdad # Ctesiphon
			completely_controls = title:d_palestina_prima # Jerusalem
			completely_controls = title:d_antioch # Antioch
			completely_controls = title:d_khuzestan # Khuzestan
		}
	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = roman_persian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_great
			if = {
				limit = {
					completely_controls = title:d_baghdad # Ctesiphon
					exists = title:e_persia
				}
				destroy_title = title:e_persia
			}
			if = {
				limit = {
					completely_controls = title:d_thrace # Constantinople
					exists = title:e_roman_empire
				}
				destroy_title = title:e_roman_empire
			}
			if = {
				limit = {
					completely_controls = title:d_thrace # Constantinople
					exists = title:e_byzantium
				}
				destroy_title = title:e_byzantium
			}		
		}
		# Boost to culture and faith conversion
		custom_tooltip = struggle_roman_persian_ending_total_victory_conversion_tt
		# De jure changes
		custom_description_no_bullet = { text = struggle_roman_persian_regional_victory_explain_de_jure_tt }	
		# Choose war boost, religion boost, or political boost
		custom_description_no_bullet = { text = struggle_roman_persian_modifier_list_tt }

		# Trigger a player facing event as a coda
		trigger_event = roman_persian_struggle.1004
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}


# Outsider victory (historical ending with the rise of the Rashidun Caliphate)
struggle_roman_persian_ending_outsider_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm_persia.dds"
	}
	decision_group_type = major

	title = struggle_roman_persian_ending_outsider_decision
	desc = struggle_roman_persian_ending_outsider_decision_desc
	selection_tooltip = struggle_roman_persian_ending_outsider_decision_tooltip
	sort_order = 80

	is_shown = {
		# Struggle is active
		exists = struggle:roman_persian_struggle
		# Not Involved and capital lies outside Iberia
		custom_tooltip = {
			text = struggle_roman_persian_uninvolved_or_external_tt
			NOR = {
				any_character_struggle = {
					is_struggle_type = roman_persian_struggle
					involvement = involved
				}
			}
		}
		# Hold land near the struggle region
		any_sub_realm_county = {
			title_province = {
				OR = {
					geographical_region = TFE_roman_persian_struggle_region
				}
			}
		}
		NOR = {
			has_title = title:e_persia
			has_title = title:e_roman_empire
			has_title = title:e_western_roman_empire
			has_title = title:e_byzantium
		}
	}

	is_valid = {
		##### General triggers #####

		# Need lots of likes
		#TODO prestige_level >= high_prestige_level
		# Struggle phase must be right
		custom_tooltip = {
			text = struggle_roman_persian_uninvolved_or_external_tt
			NOT = {
				capital_province = { geographical_region = TFE_roman_persian_struggle_region }
			}
		}
		custom_tooltip = {
			text = struggle_roman_persian_empire_tt
			AND = {
				NOT = {
					has_title = title:e_byzantium
				}
				NOT = {
					has_title = title:e_western_roman_empire
				}
				NOT = {
					has_title = title:e_roman_empire
				}
				NOT = {
					has_title = title:e_persia
				}
			}
		}

		highest_held_title_tier = tier_empire

		# Control at least 75% of the struggle region
		custom_tooltip = {
			text = struggle_roman_persian_ending_regional_decision_region_tt
			struggle_roman_persian_ending_regional_decision_percent_region_trigger = yes
		}	

		# Completely control at least 3 of the important duchies
		calc_true_if = {
			amount >= 3
			completely_controls = title:d_thrace # Constantinople
			completely_controls = title:d_baghdad # Ctesiphon
			completely_controls = title:d_palestina_prima # Jerusalem
			completely_controls = title:d_antioch # Antioch
			completely_controls = title:d_khuzestan # Khuzestan
		}

	}


	effect = {

		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 5000 }
			if = {
				limit = {
					completely_controls = title:d_baghdad # Ctesiphon
					exists = title:e_persia
				}
				destroy_title = title:e_persia
			}
			if = {
				limit = {
					completely_controls = title:d_thrace # Constantinople
					exists = title:e_roman_empire
				}
				destroy_title = title:e_roman_empire
			}
			if = {
				limit = {
					completely_controls = title:d_thrace # Constantinople
					exists = title:e_byzantium
				}
				destroy_title = title:e_byzantium
			}
			# De jure changes
			custom_description_no_bullet = { text = struggle_roman_persian_regional_victory_explain_de_jure_tt }	
		}

		trigger_event = {
			id = roman_persian_struggle.1006
		}

		custom_tooltip = TFE_roman_persian_struggle_ends_tt
	}

	cost = {}

	ai_check_interval = 120
	
	ai_potential = {}

	ai_will_do = {
		base = 100
	}
}


###################################################
# 
# EASTERN IRANIAN STRUGGLE ENDINGS
# By cybrxkhan
# 
###################################################


# Domination
struggle_eastern_iranian_ending_domination_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_dehqan.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_dehqan.dds"
	decision_group_type = major
	
	title = struggle_eastern_iranian_ending_domination_decision
	desc = struggle_eastern_iranian_ending_domination_decision_desc
	selection_tooltip = struggle_eastern_iranian_ending_domination_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_eastern_iranian_ending_domination_correct_phase_tt
			any_character_struggle = {
				is_struggle_type = eastern_iranian_struggle
				OR = {
					is_struggle_phase = struggle_TFE_eastern_iranian_phase_expansion
					is_struggle_phase = struggle_TFE_eastern_iranian_phase_hostility
				}
			}
		}

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = eastern_iranian_struggle
			}
		}

		prestige_level >= 4
		highest_held_title_tier >= tier_kingdom

		# Control at least 75% of the struggle region
		custom_tooltip = {
			text = struggle_eastern_iranian_ending_domination_region_tt
			struggle_eastern_iranian_ending_domination_percent_region_trigger = yes
		}


		# OR = {
		# 	culture = { has_cultural_pillar = heritage_iranian } # West Iranians
		# 	culture = { has_cultural_pillar = heritage_tocharian } # East Iranians
		# }

		# No other realm controls more than 20% of the region
		custom_tooltip = {
			text = struggle_eastern_iranian_ending_domination_decision_region_tt
			NOT = {
				struggle:eastern_iranian_struggle = {
					any_involved_ruler = {
						NOT = { this = root }
						is_independent_ruler = yes
						exists = primary_title
						primary_title = { is_mercenary_company = no }
						save_temporary_scope_as = eastern_iranian_region_realm
						any_county_in_region = {
							region = TFE_eastern_iranian_struggle_region
							percent > fp2_struggle_hostility_region_percent_decimal_value
							holder.top_liege = scope:eastern_iranian_region_realm
						}
					}
				}
			}
		}

	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = eastern_iranian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_great
		}
		# Boost to culture and faith conversion
		custom_tooltip = struggle_eastern_iranian_ending_bonus_conversion_tt
		# Choose variation of dominance boost
		custom_description_no_bullet = { text = struggle_eastern_iranian_dominance_modifier_list_tt }

		# Trigger a player facing event as a coda
		trigger_event = eastern_iranian_struggle.1000
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}


# Silk Road/Prosperity
struggle_eastern_iranian_ending_silk_road_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_mena_palace.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_mena_palace.dds"
	decision_group_type = major

	title = struggle_eastern_iranian_ending_silk_road_decision
	desc = struggle_eastern_iranian_ending_silk_road_decision_desc
	selection_tooltip = struggle_eastern_iranian_ending_silk_road_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_eastern_iranian_ending_silk_road_correct_phase_tt
			any_character_struggle = {
				is_struggle_type = eastern_iranian_struggle
				OR = {
					is_struggle_phase = struggle_TFE_eastern_iranian_phase_expansion
					is_struggle_phase = struggle_TFE_eastern_iranian_phase_development
				}
			}
		}

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = eastern_iranian_struggle
			}
		}

		prestige_level >= 4
		highest_held_title_tier >= tier_kingdom

		# Control at least 40% of the struggle region
		custom_tooltip = {
			text = struggle_eastern_iranian_ending_silk_road_region_tt
			struggle_eastern_iranian_ending_silk_road_percent_region_trigger = yes
		}

		# Own at least 5 counties in the struggle region with 80 development, including your capital
		custom_tooltip = {
			text = struggle_eastern_iranian_ending_silk_road_county_req_tt
			capital_county = {
				development_level >= struggle_eastern_iranian_development_req_value
				title_province = { geographical_region = TFE_eastern_iranian_struggle_region }
			}
			any_held_county = {
				count >= struggle_eastern_iranian_development_county_value
				development_level >= struggle_eastern_iranian_development_req_value
				title_province = { geographical_region = TFE_eastern_iranian_struggle_region }
			}
			# capital_county.de_jure_liege.de_jure_liege = {
			# 	any_de_jure_county = {
			# 		percent >= 0.8
			# 		culture = root.culture
			# 		faith = root.faith
			# 	}
			# }
		}


		# OR = {
		# 	culture = { has_cultural_pillar = heritage_iranian } # West Iranians
		# 	culture = { has_cultural_pillar = heritage_tocharian } # East Iranians
		# }

		# No other realm controls more than 20% of the region
		# custom_tooltip = {
		# 	text = struggle_eastern_iranian_ending_total_victory_decision_region_tt
		# 	NOT = {
		# 		struggle:roman_persian_struggle = {
		# 			any_involved_ruler = {
		# 				NOT = { this = root }
		# 				is_independent_ruler = yes
		# 				exists = primary_title
		# 				primary_title = { is_mercenary_company = no }
		# 				save_temporary_scope_as = eastern_iranian_region_realm
		# 				any_county_in_region = {
		# 					region = TFE_eastern_iranian_struggle_region
		# 					percent > fp2_struggle_hostility_region_percent_decimal_value
		# 					holder.top_liege = scope:eastern_iranian_region_realm
		# 				}
		# 			}
		# 		}
		# 	}
		# }

	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = eastern_iranian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_great
		}
		# Boost to culture and faith conversion
		custom_tooltip = struggle_eastern_iranian_ending_bonus_conversion_tt
		# Choose economic, cultural, or military boost
		custom_description_no_bullet = { text = struggle_eastern_iranian_silk_road_prosperity_modifier_list_tt }

		# Trigger a player facing event as a coda
		trigger_event = eastern_iranian_struggle.1002
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}


# Decentralized Polities
struggle_eastern_iranian_ending_compromise_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_qanat.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_qanat.dds"
	decision_group_type = major

	title = struggle_eastern_iranian_ending_compromise_decision
	desc = struggle_eastern_iranian_ending_compromise_decision_desc
	selection_tooltip = struggle_eastern_iranian_ending_compromise_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_eastern_iranian_ending_compromise_decision_correct_phase_tt
			any_character_struggle = {
				AND = {
					is_struggle_type = eastern_iranian_struggle
					is_struggle_phase = struggle_TFE_eastern_iranian_phase_compromise
				}
			}
		}

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = eastern_iranian_struggle
			}
		}

		OR = {
			# Exalted among Men or higher
			prestige_level >= very_high_prestige_level
			# Hold and completely control a de jure kingdom of Hispania
			custom_tooltip = {
				text = struggle_eastern_iranian_ending_compromise_decision_kingdom_tt
				tfe_struggle_ending_hold_de_jure_kingdom_trigger_persia = yes
			}
		}

		# Control less than 50% of Iberia
		custom_tooltip = {
			text = struggle_eastern_iranian_ending_compromise_decision_region_tt
			tfe_struggle_ending_percent_persia_trigger = yes
		}

		# No one else controls more than 50% of Iberia
		custom_tooltip = {
			text = struggle_eastern_iranian_ending_compromise_decision_other_region_tt
			tfe_struggle_ending_other_percent_persia_trigger = yes
		}

		# No Independent Involved rulers are at war with each other
		custom_tooltip = {
			text = struggle_iberia_ending_compromise_truce_tt
			NOT = {
				struggle:eastern_iranian_struggle = {
					any_involved_ruler = {
						is_independent_ruler = yes
						primary_title = { is_mercenary_company = no }
						any_primary_war_enemy = {
							is_independent_ruler = yes
							any_character_struggle = {
								involvement = involved
								is_struggle_type = eastern_iranian_struggle
							}
							primary_title = { is_mercenary_company = no }
						}
					}
				}
			}
		}

		OR = {
			# Every other involved independent ruler in Eastern Iranian region has at least 60 opinion of you or is strong hooked
			custom_tooltip = {
				text = struggle_eastern_iranian_ending_compromise_decision_opinion_tt
				struggle:eastern_iranian_struggle = {
					NOT = {
						any_involved_ruler = {
							NOT = { this = root }
							is_independent_ruler = yes
							primary_title = { is_holy_order = no }
							primary_title = { is_mercenary_company = no }
							save_temporary_scope_as = this_character
							NOR = {
								root = { has_strong_hook = scope:this_character }
								opinion = {
									target = root
									value >= struggle_iberia_ending_compromise_decision_opinion_value
								}
							}
						}
					}
				}
			}
			# No other independent ruler in Eastern Iranian region is a king or above
			custom_tooltip = {
				text = struggle_eastern_iranian_ending_compromise_decision_independent_tt
				struggle:eastern_iranian_struggle = {
					NOT = {
						any_involved_ruler = {
							NOT = { this = root }
							is_independent_ruler = yes
							primary_title = { is_mercenary_company = no }
							primary_title.tier >= tier_kingdom
						}
					}
				}
			}
			# More than 25% of Eastern Iranian region is controlled by Interloper or Uninvolved rulers
			custom_tooltip = {
				text = struggle_eastern_iranian_ending_compromise_decision_interloper_tt
				any_county_in_region = {
					region = TFE_eastern_iranian_struggle_region
					percent > fp2_struggle_compromise_uninvolved_percent_decimal_value
					holder.top_liege = {
						NOT = {
							any_character_struggle = {
								involvement = involved
								is_struggle_type = eastern_iranian_struggle
							}
						}				
					}
				}
			}
		}
	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = eastern_iranian_struggle
			}
		}
		##### Major Effects #####
		# Personal effects for ruler
		show_as_tooltip = { tfe_struggle_compromise_ender_effect = yes }
		# any_county_in_region
		# Independent/Split De Jure Duchies will become De Jure Kingdoms
		# if = {
		# 	limit = {
		# 		every_county_in_region = {
		# 			region = TFE_eastern_iranian_struggle_region
		# 			any_this_title_or_de_jure_above = {
		# 				fp2_struggle_ending_compromise_independent_duchy_trigger = yes
		# 				# NOT = { this = }
		# 			}
		# 		}
		# 	}
		# 	custom_tooltip = tfe_iranian_struggle_compromise_create_new_kingdoms_tt
		# }
		# if = {
		# 	limit = {
		# 		title:e_persia = {
		# 			any_in_de_jure_hierarchy = {
		# 				fp2_struggle_ending_compromise_independent_duchy_trigger = yes
		# 				# NOT = { this = }
		# 			}
		# 		}
		# 	}
		# 	custom_tooltip = tfe_iranian_struggle_compromise_create_new_kingdoms_tt
		# }
		# if = {
		# 	limit = {
		# 		title:e_turan = {
		# 			any_in_de_jure_hierarchy = {
		# 				fp2_struggle_ending_compromise_independent_duchy_trigger = yes
		# 			}
		# 		}
		# 	}
		# 	custom_tooltip = tfe_iranian_struggle_compromise_create_new_kingdoms_tt
		# }
		# Other Tooltips!
		tfe_iranian_struggle_compromise_tooltip_effect = yes

		##### Minor Effects #####
		# Self-sufficiency/defensive modifiers for each independent realm
		show_as_tooltip = { fp2_struggle_compromise_modifier_rewards_effect = yes }

		show_as_tooltip = {
			stress_impact = {
				arrogant = medium_stress_impact_gain
			}
		}


		# Trigger a player facing event as a coda
		trigger_event = eastern_iranian_struggle.1004
	}

	cost = { gold = { value = 150 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}

#Eastern Iranian Struggle Silk Road Urbanization Decision (totally not copied from the discord title)
struggle_eastern_iranian_urbanize_area = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_qanat.dds"
	}

	desc = struggle_eastern_iranian_urbanize_area_desc
	selection_tooltip = struggle_eastern_iranian_urbanize_area_tooltip
	ai_check_interval = 0
	cooldown = { years = 15 }

	is_shown = {
		capital_county = {
			title_province = {
				geographical_region = TFE_eastern_iranian_struggle_region
			}
		}
	}

	is_valid_showing_failures_only = {
		is_at_war = no
		is_adult = yes
	}

	effect = {
		# Get some good county opinion, and prevent said counties from joining popular revolts
		# show_as_tooltip = {
		# 	capital_county = {
		# 		add_county_modifier = {
		# 			modifier = urbanize_silk_road_modifier
		# 			years = 10
		# 		}
		# 	}
		# }
		custom_tooltip = struggle_eastern_iranian_urbanize_area_extend_to_county
		if = {
			limit = {
				primary_title.tier >= tier_duchy
				any_held_title = { tier = tier_duchy }
				capital_county.duchy = {
					is_title_created = yes
				}
			}
			custom_tooltip = struggle_eastern_iranian_urbanize_area_extend_to_duchy
		}
		if = {
			limit = {
				primary_title.tier >= tier_kingdom
				any_held_title = { tier = tier_kingdom }
				capital_county.kingdom = {
					is_title_created = yes
				}
			}
			custom_tooltip = struggle_eastern_iranian_urbanize_area_extend_to_kingdom
		}
		if = {
			limit = {
				primary_title.tier >= tier_empire
				any_held_title = { tier = tier_empire }
				capital_county.empire = {
					is_title_created = yes
				}
			}
			custom_tooltip = struggle_eastern_iranian_urbanize_area_extend_to_empire
		}
		
		trigger_event = eastern_iranian_struggle.2001
	}

	ai_will_do = {
		base = 20
	}
}





###################################################
# 
# NORTH INDIAN/HUNAS INVASION STRUGGLE ENDINGS
# By cybrxkhan
# 
###################################################

# Hun/Hunas Victory
struggle_north_indian_ending_foreign_domination_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_steppe_feast.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_steppe_feast_small.dds"
	decision_group_type = major

	title = struggle_north_indian_ending_foreign_domination_decision
	desc = struggle_north_indian_ending_foreign_domination_decision_desc
	selection_tooltip = struggle_north_indian_ending_foreign_domination_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_north_indian_ending_foreign_domination_correct_phase_tt
			any_character_struggle = {
				is_struggle_type = north_indian_struggle
				OR = {
					is_struggle_phase = struggle_TFE_north_indian_phase_invasion
					is_struggle_phase = struggle_TFE_north_indian_phase_glory
				}
			}
		}

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = north_indian_struggle
			}
		}

		prestige_level >= 4
		highest_held_title_tier >= tier_kingdom

		# Control at least 75% of the struggle region
		custom_tooltip = {
			text = struggle_north_indian_ending_domination_region_tt
			struggle_north_indian_ending_domination_percent_region_trigger = yes
		}

		# Completely control at least 4 of the important duchies
		calc_true_if = {
			amount >= 4
			completely_controls = title:d_balkh # Balkh
			completely_controls = title:d_kabul # Balkh
			completely_controls = title:d_gandhara # Gandhara
			completely_controls = title:d_magadha # Magadha
			completely_controls = title:d_sauvira # Sindh
			completely_controls = title:d_dadhipadra # Avanti/Malwa
			completely_controls = title:d_gauda # Gauda
		}


		NOR = {
			culture = { has_cultural_pillar = heritage_indo_aryan } # Indo-Aryans
			culture = { has_cultural_pillar = heritage_dravidian } # Dravidians
			culture = { has_cultural_pillar = heritage_kherwal } # Kherwal / Munda
		}

		# No other realm controls more than 20% of the region
		custom_tooltip = {
			text = struggle_north_indian_ending_others_domination_decision_region_tt
			NOT = {
				struggle:north_indian_struggle = {
					any_involved_ruler = {
						NOT = { this = root }
						is_independent_ruler = yes
						exists = primary_title
						primary_title = { is_mercenary_company = no }
						save_temporary_scope_as = north_indian_region_realm
						any_county_in_region = {
							region = TFE_north_indian_struggle_region
							percent > fp2_struggle_hostility_region_percent_decimal_value
							holder.top_liege = scope:north_indian_region_realm
						}
					}
				}
			}
		}

	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = north_indian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_great
		}
		# Choose variation of dominance boost
		custom_description_no_bullet = { text = struggle_north_indian_foreigner_modifier_list_tt }

		# Trigger a player facing event as a coda
		trigger_event = north_indian_struggle.1000
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}



# Indian Victory
struggle_north_indian_ending_indian_domination_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_indian_throne_room.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_indian_throne_room_small.dds"
	decision_group_type = major

	title = struggle_north_indian_ending_indian_domination_decision
	desc = struggle_north_indian_ending_indian_domination_decision_desc
	selection_tooltip = struggle_north_indian_ending_indian_domination_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_north_indian_ending_indian_domination_correct_phase_tt
			any_character_struggle = {
				is_struggle_type = north_indian_struggle
				OR = {
					is_struggle_phase = struggle_TFE_north_indian_phase_invasion
					is_struggle_phase = struggle_TFE_north_indian_phase_glory
				}
			}
		}

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = north_indian_struggle
			}
		}

		prestige_level >= 4
		highest_held_title_tier >= tier_kingdom

		# Control at least 75% of the struggle region
		custom_tooltip = {
			text = struggle_north_indian_ending_domination_region_tt
			struggle_north_indian_ending_domination_percent_region_trigger = yes
		}

		# Completely control at least 4 of the important duchies
		calc_true_if = {
			amount >= 4
			completely_controls = title:d_balkh # Balkh
			completely_controls = title:d_kabul # Balkh
			completely_controls = title:d_gandhara # Gandhara
			completely_controls = title:d_magadha # Magadha
			completely_controls = title:d_sauvira # Sindh
			completely_controls = title:d_dadhipadra # Avanti/Malwa
			completely_controls = title:d_gauda # Gauda
		}


		OR = {
			culture = { has_cultural_pillar = heritage_indo_aryan } # Indo-Aryans
			culture = { has_cultural_pillar = heritage_dravidian } # Dravidians
			culture = { has_cultural_pillar = heritage_kherwal } # Kherwal / Munda
		}

		# No other realm controls more than 20% of the region
		custom_tooltip = {
			text = struggle_north_indian_ending_others_domination_decision_region_tt
			NOT = {
				struggle:north_indian_struggle = {
					any_involved_ruler = {
						NOT = { this = root }
						is_independent_ruler = yes
						exists = primary_title
						primary_title = { is_mercenary_company = no }
						save_temporary_scope_as = north_indian_region_realm
						any_county_in_region = {
							region = TFE_north_indian_struggle_region
							percent > fp2_struggle_hostility_region_percent_decimal_value
							holder.top_liege = scope:north_indian_region_realm
						}
					}
				}
			}
		}

	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = north_indian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_great
		}
		# Choose variation of dominance boost
		custom_description_no_bullet = { text = struggle_north_indian_indian_modifier_list_tt }

		# Trigger a player facing event as a coda
		trigger_event = north_indian_struggle.1002
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}


# Confluence/Peaceful Ending
struggle_north_indian_ending_confluence_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_indian_temple.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_indian_temple_small.dds"
	decision_group_type = major

	title = struggle_north_indian_ending_confluence_decision
	desc = struggle_north_indian_ending_confluence_decision_desc
	selection_tooltip = struggle_north_indian_ending_confluence_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_north_indian_ending_confluence_correct_phase_tt
			any_character_struggle = {
				is_struggle_type = north_indian_struggle
				OR = {
					is_struggle_phase = struggle_TFE_north_indian_phase_interchange
					is_struggle_phase = struggle_TFE_north_indian_phase_glory
				}
			}
		}

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = north_indian_struggle
			}
		}

		prestige_level >= 4
		highest_held_title_tier >= tier_kingdom

		# Own at least 5 counties you hold in the struggle region with 80 development, including your capital
		custom_tooltip = {
			text = struggle_north_indian_ending_confluence_county_req_tt
			capital_county = {
				development_level >= struggle_north_indian_development_req_value
				title_province = { geographical_region = TFE_north_indian_struggle_region }
			}
			any_held_county = {
				count >= struggle_north_indian_development_county_value
				development_level >= struggle_north_indian_development_req_value
				title_province = { geographical_region = TFE_north_indian_struggle_region }
			}
		}

		custom_tooltip = {
			text = struggle_north_indian_ending_buddhism_county_req_tt
			any_realm_county = {
				count >= struggle_north_indian_religion_county_value
				religion = religion:buddhism_religion
				title_province = { geographical_region = TFE_north_indian_struggle_region }
			}
		}

		custom_tooltip = {
			text = struggle_north_indian_ending_hinduism_county_req_tt
			any_realm_county = {
				count >= struggle_north_indian_religion_county_value
				religion = religion:hinduism_religion
				title_province = { geographical_region = TFE_north_indian_struggle_region }
			}
		}

		custom_tooltip = {
			text = struggle_north_indian_ending_jainism_county_req_tt
			any_realm_county = {
				count >= struggle_north_indian_religion_county_value
				religion = religion:jainism_religion
				title_province = { geographical_region = TFE_north_indian_struggle_region }
			}
		}
	
	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = north_indian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_great
		}
		# Choose economic, cultural, or military boost
		custom_description_no_bullet = { text = struggle_north_indian_confluence_modifier_list_tt }

		# Trigger a player facing event as a coda
		trigger_event = north_indian_struggle.1004
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}





###################################################
# 
# ITALIAN/GOTHIC/FALL OF ROME STRUGGLE ENDINGS
# By cybrxkhan
# 
###################################################

# Synthesis Victory (Theodoric)
struggle_italian_ending_synthesis_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_roman_city.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_roman_city_small.dds"
	decision_group_type = major

	title = struggle_italian_ending_synthesis_decision
	desc = struggle_italian_ending_synthesis_decision_desc
	selection_tooltip = struggle_italian_ending_synthesis_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = italian_struggle
			}
		}

		
		# Descended from a Hellenistic or Latin culture
		custom_tooltip = {
			text = TFE_struggle_italian_ending_synthesis_hellenistic_roman_heritage_tt
			any_parent_culture_or_above = {
				OR = {
					has_cultural_pillar = heritage_hellenistic
					has_cultural_pillar = heritage_latin
				}
			}
		}

		
		# Descended from a culture that's neither Hellenistic or Latin
		custom_tooltip = {
			text = TFE_struggle_italian_ending_synthesis_outside_heritage_tt
			any_parent_culture_or_above = {
				NOT = {
					has_cultural_pillar = heritage_latin
				}
				NOT = {
					has_cultural_pillar = heritage_hellenistic
				}
			}
		}

		# Have at least 50 dev in each county of your capital's de jure duchy
		custom_tooltip = {
			text = TFE_italian_struggle_ending_development_tt
			NOT = {
				capital_county.duchy = {
					any_in_de_jure_hierarchy = {
						tier = tier_county
						development_level < TFE_italian_struggle_ending_development_level
					}
				}
			}
		}


		# At least 20% of your realm is populated by Latin or Hellenistic cultures
		# custom_tooltip = {
		# 	text = TFE_italian_struggle_ending_development_tt
		# 	any_realm_county = {
		# 		percent >= 0.2
		# 		culture = culture:roman
		# 	}
		# }

		prestige_level >= 3
		highest_held_title_tier >= tier_kingdom

		# Control at least 40% of the struggle region
		custom_tooltip = {
			text = struggle_italian_ending_synthesis_region_tt
			struggle_italian_ending_synthesis_percent_region_trigger = yes
		}


		completely_controls = title:d_romagna # Ravenna
		completely_controls = title:d_latium # Latium

	}

	effect = {
		save_scope_as = italian_struggle_ender
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = italian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_great
			add_legitimacy = major_legitimacy_gain
			TFE_italian_struggle_synthesis_county_effect = yes
			TFE_italian_struggle_synthesis_tooltip_effect = yes
		}

		TFE_italian_struggle_end_effect = {
			ENDING = yes
			EVENT = italian_struggle.1000
			FLAG = flag:TFE_italian_struggle_synthesis_ending
		}

		# Trigger the ending event
		# every_ruler = {
		# 	limit = {
		# 		OR = {
		# 			this = scope:italian_struggle_ender
		# 			any_held_county = {
		# 				any_county_province = {
		# 					OR = {
		# 						geographical_region = world_europe
		# 						geographical_region = world_steppe_west
		# 						geographical_region = world_middle_east
		# 						geographical_region = world_africa_north
		# 						geographical_region = world_africa_sahara
		# 						geographical_region = world_africa_east
		# 						geographical_region = world_asia_minor
		# 					}
		# 				}
		# 			}
		# 		}
		# 	}
		# 	trigger_event = italian_struggle.1000
		# }
		
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}



# Incorporation Victory
struggle_italian_ending_incorporation_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_estate_mediterranean.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_estate_mediterranean_small.dds"
	decision_group_type = major

	title = struggle_italian_ending_incorporation_decision
	desc = struggle_italian_ending_incorporation_decision_desc
	selection_tooltip = struggle_italian_ending_incorporation_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = italian_struggle
			}
		}

		prestige_level >= 4
		highest_held_title_tier >= tier_kingdom

		# Control at least 60% of the struggle region
		custom_tooltip = {
			text = struggle_italian_ending_incorporation_region_tt
			struggle_italian_ending_incorporation_percent_region_trigger = yes
		}

		completely_controls = title:d_romagna # Ravenna
		completely_controls = title:d_latium # Latium

		NOT = {
			culture = { has_cultural_pillar = heritage_latin } # Romans
		}

		NOT = {
			culture = { has_cultural_pillar = heritage_hellenistic } # Greeks
		}

		NOR = {
			has_title = title:e_roman_empire
			has_title = title:e_western_roman_empire
			has_title = title:e_byzantium
		}

		OR = {

			trigger_if = {
				limit = { 
					exists = title:e_roman_empire.holder
				}
				title:e_roman_empire.holder = {
					opinion = {
						target = root
						value >= 50
					}
				}
			}
			trigger_else = {
				exists = title:e_roman_empire.holder
			}

			trigger_if = {
				limit = { 
					exists = title:e_western_roman_empire.holder
				}
				title:e_western_roman_empire.holder = {
					opinion = {
						target = root
						value >= 50
					}
				}
			}
			trigger_else = {
				exists = title:e_western_roman_empire.holder
			}

			trigger_if = {
				limit = { 
					exists = title:e_byzantium.holder
				}
				title:e_byzantium.holder = {
					opinion = {
						target = root
						value >= 50
					}
				}
			}
			trigger_else = {
				exists = title:e_byzantium.holder
			}

		}

	}

	effect = {
		save_scope_as = italian_struggle_ender
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = italian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 5000 }
			add_prestige = 5000
			give_nickname = nick_the_peacekeeper
			TFE_italian_struggle_incorporation_personal_effect = yes
			TFE_italian_struggle_incorporation_vassal_effect = yes
			TFE_italian_struggle_incorporation_county_effect = yes
		}

		TFE_italian_struggle_end_effect = {
			ENDING = yes
			EVENT = italian_struggle.1001
			FLAG = flag:TFE_italian_struggle_incorporation_ending
		}

	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}

# Restoration Victory (Justinian)
struggle_italian_ending_restoration_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_mediterranean_throne_room.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_mediterranean_throne_room_small.dds"
	decision_group_type = major

	title = struggle_italian_ending_restoration_decision
	desc = struggle_italian_ending_restoration_decision_desc
	selection_tooltip = struggle_italian_ending_restoration_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = italian_struggle
			}
		}

		prestige_level >= 3
		piety_level >= 3
		legitimacy_level >= 4
		highest_held_title_tier >= tier_kingdom

		# Control at least % of the struggle region
		custom_tooltip = {
			text = struggle_italian_ending_restoration_region_tt
			struggle_italian_ending_restoration_percent_region_trigger = yes
		}

		completely_controls = title:d_romagna # Ravenna
		completely_controls = title:d_latium # Latium

		OR = {
			culture = { has_cultural_pillar = heritage_latin } # Romans
			culture = { has_cultural_pillar = heritage_hellenistic } # Greeks
		}

		OR = {
			has_title = title:e_roman_empire
			has_title = title:e_western_roman_empire
			has_title = title:e_byzantium
			# Disabled this since it's easier this way
			# top_liege = {
			# 	OR = {
			# 		has_title = title:e_roman_empire
			# 		has_title = title:e_western_roman_empire
			# 		has_title = title:e_byzantium
			# 	}
			# }
		}

		# No independent kings or emperors in Italia outside of Constantinople
		custom_tooltip = {
			text = TFE_italian_struggle_no_independent_king_or_emperor_no_constantinople
			NOT = {
				any_county_in_region = {
					region = TFE_italian_struggle_region_minus_constantinople
					holder = {
						NOT = { this = root }
						is_independent_ruler = yes
						primary_title = { is_mercenary_company = no }
						primary_title = { is_holy_order = no }
						highest_held_title_tier >= tier_kingdom
					}
				}
			}
		}

	}

	effect = {
		save_scope_as = italian_struggle_ender
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = italian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			add_legitimacy = major_legitimacy_gain
			give_nickname = nick_the_great
			TFE_italian_struggle_restoration_personal_effect = yes
			TFE_italian_struggle_restoration_vassal_effect = yes
			TFE_italian_struggle_restoration_county_effect = yes
		}

		TFE_italian_struggle_end_effect = {
			ENDING = yes
			EVENT = italian_struggle.1002
			FLAG = flag:TFE_italian_struggle_restoration_ending
		}

	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}

# Subjugation Victory (Lombards)
struggle_italian_ending_subjugation_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_funeral_pyre.dds"
	}
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_funeral_pyre_small.dds"
	decision_group_type = major

	title = struggle_italian_ending_subjugation_decision
	desc = struggle_italian_ending_subjugation_decision_desc
	selection_tooltip = struggle_italian_ending_subjugation_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = italian_struggle
			}
		}

		prestige_level >= 3
		#piety_level >= 3
		legitimacy_level >= 4
		highest_held_title_tier >= tier_kingdom

		# Control at least % of the struggle region
		custom_tooltip = {
			text = struggle_italian_ending_restoration_region_tt
			struggle_italian_ending_restoration_percent_region_trigger = yes
		}

		completely_controls = title:d_romagna # Ravenna
		completely_controls = title:d_latium # Latium

		NOR = {
			culture = { has_cultural_pillar = heritage_latin } # Romans
			culture = { has_cultural_pillar = heritage_hellenistic } # Greeks
		}

		NOR = {
			has_title = title:e_roman_empire
			has_title = title:e_western_roman_empire
			has_title = title:e_byzantium
		}

		# No independent kings or emperors in Italia outside of Constantinople
		custom_tooltip = {
			text = TFE_italian_struggle_no_independent_king_or_emperor_no_constantinople
			NOT = {
				any_county_in_region = {
					region = TFE_italian_struggle_region_minus_constantinople
					holder = {
						NOT = { this = root }
						is_independent_ruler = yes
						primary_title = { is_mercenary_company = no }
						primary_title = { is_holy_order = no }
						highest_held_title_tier >= tier_kingdom
					}
				}
			}
		}

	}

	effect = {
		save_scope_as = italian_struggle_ender
		if = {
			limit = { has_dlc_feature = legends }
			legend_seed_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = italian_struggle
			}
		}
		##### Major Effects #####
		show_as_tooltip = {
			dynasty = { add_dynasty_prestige = 10000 }
			give_nickname = nick_the_great
			add_legitimacy = major_legitimacy_gain
			TFE_italian_struggle_subjugation_personal_effect = yes
			TFE_italian_struggle_subjugation_vassal_effect = yes
			TFE_italian_struggle_subjugation_county_effect = yes
		}


		# Trigger a player facing event as a coda
		TFE_italian_struggle_end_effect = {
			ENDING = yes
			EVENT = italian_struggle.1003
			FLAG = flag:TFE_italian_struggle_restoration_ending
		}
	}

	cost = { gold = { value = 200 } }

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }

}







